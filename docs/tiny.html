<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>tiny.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>tiny.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <!-- vim: set et sts=2 sw=2 ts=2 : -->

<h2>SYNOPSIS:</h2>
<p>tiny: look around just a little, then guess where is the good stuff <br />
  (c) 2023, Tim Menzies, <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#116;&#105;&#109;&#109;&#64;&#105;&#101;&#101;&#101;&#46;&#111;&#114;&#103;">&#116;&#105;&#109;&#109;&#64;&#105;&#101;&#101;&#101;&#46;&#111;&#114;&#103;</a>  BSD-2</p>
<h2>USAGE:</h2>
<p>./tiny.py [OPTIONS] [-g ACTIONS]</p>
<h2>DESCRIPTION:</h2>
<p>Use to find best regions within rows of data with multiple objectives.
  N rows of data are ranked via a multi-objective domination predicate
  and then discretized, favoring ranges that distinguish the best
  (N^min) items from a sample of the rest*(N^min)</p>
<h2>OPTIONS:</h2>
<pre><code> -b  --bins    max number of bins    = 16  
 -B  --Beam    explore top 'B' ranges = 8  
 -c  --cohen   size significant separation = .35  
 -f  --file    data csv file         = ../data/auto93.csv  
 -g  --go      start up action       = nothing  
 -h  --help    show help             = False  
 -k  --keep    how many nums to keep = 512  
 -m  --min     min size              = .5  
 -r  --rest    ratio best:rest       = 3  
 -s  --seed    random number seed    = 1234567891  
 -w  --want    what goal to chase    = mitigate
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span><span class="o">,</span><span class="nn">math</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">ast</span><span class="o">,</span><span class="nn">re</span>
<span class="kn">from</span> <span class="nn">termcolor</span> <span class="kn">import</span> <span class="n">colored</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cmp_to_key</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <hr />
<h2>Config</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p><code>the</code> is where we store config options. These options are parsed
out of the above doc string (using the <code>settings</code> function).
Optionally, these options are updated from command-line (using the <code>cli</code> function).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">the</span><span class="o">=</span><span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <h2>Factories</h2>
<p>Factories make instances and have UPPER-CASE names (e.g. NUM, SYM, etc).
In my code, any lower case factory names are instances (e.g. <code>num</code> is an instance of NUM).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <h3>obj</h3>
<p><code>obj</code> is  simple class that prints pretty, hashes easy, and inits easy.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">obj</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="n">oid</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span> <span class="n">obj</span><span class="o">.</span><span class="n">oid</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_id</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">oid</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>     <span class="p">:</span> <span class="k">return</span> <span class="n">printd</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>     <span class="p">:</span> <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">_idbrew</span> <span class="n">install</span> <span class="n">entr</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <h3>ROW</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">ROW</span><span class="p">(</span><span class="n">cells</span><span class="o">=</span><span class="p">[]):</span>
  <span class="k">return</span> <span class="n">obj</span><span class="p">(</span><span class="n">this</span><span class="o">=</span><span class="n">ROW</span><span class="p">,</span><span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <h3>NUM and SYM (which are &ldquo;columns&rdquo;)</h3>
<p>All my columns count items seen (in <code>n</code>). Also, <code>col.this is NUM</code> is the idiom
for recognizing a column of a particular type.
For example, SYMs summarizes streams of symbols (and SYMs knos frequency counts and <code>mode</code>).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">SYM</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">obj</span><span class="p">(</span><span class="n">this</span><span class="o">=</span><span class="n">SYM</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
             <span class="n">counts</span><span class="o">=</span><span class="p">{},</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">most</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>NUMs summarizes streams of numbers (and NUMs know <code>lo,hi</code> and keeps a sample
of those numbers in <code>_kept</code>). For goals, NUMs can have a weight of -1,1 denoting things to be
minimized or maximized (respectively).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">NUM</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
   <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">txt</span> <span class="ow">and</span> <span class="n">txt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;-&quot;</span> <span class="k">else</span> <span class="mi">1</span>
   <span class="k">return</span> <span class="n">obj</span><span class="p">(</span><span class="n">this</span><span class="o">=</span><span class="n">NUM</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">_kept</span><span class="o">=</span><span class="p">[],</span> <span class="n">ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="n">inf</span><span class="p">,</span> <span class="n">hi</span><span class="o">=-</span><span class="n">inf</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>NUMs and SYMs can be incrementally updated.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span> <span class="k">return</span>
  <span class="n">col</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">n</span>
  <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">this</span> <span class="ow">is</span> <span class="n">SYM</span><span class="p">:</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">col</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">now</span> <span class="o">&gt;</span> <span class="n">col</span><span class="o">.</span><span class="n">most</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">most</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">now</span><span class="p">,</span> <span class="n">x</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">col</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">col</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">_kept</span>
    <span class="k">if</span>   <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">the</span><span class="o">.</span><span class="n">keep</span>    <span class="p">:</span> <span class="c1">#  there is space, keep `x`, so just keep it</span>
      <span class="n">col</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">a</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">r</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">the</span><span class="o">.</span><span class="n">keep</span><span class="o">/</span><span class="n">col</span><span class="o">.</span><span class="n">n</span> <span class="p">:</span> <span class="c1"># else, keep some things (by replace old things)</span>
      <span class="n">col</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">a</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">())]</span> <span class="o">=</span> <span class="n">x</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>NUM _kept can get jumbled up so before we use it, make sure it is <code>ok</code> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">ok</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">this</span> <span class="ow">is</span> <span class="n">NUM</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
    <span class="n">col</span><span class="o">.</span><span class="n">_kept</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">col</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">True</span>
  <span class="k">return</span> <span class="n">col</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p><code>norm</code>alize a NUM value 0..1</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">num</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">num</span><span class="o">.</span><span class="n">lo</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">inf</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p><code>mid</code> of a col is the central tendency and is mode or median for SYMs and NUMs, respectively.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">mode</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">this</span> <span class="ow">is</span> <span class="n">SYM</span> <span class="k">else</span> <span class="n">rnd</span><span class="p">(</span><span class="n">median</span><span class="p">(</span><span class="n">ok</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">_kept</span><span class="p">),</span><span class="n">decimals</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p><code>div</code> of a col is the diversity (how far we stray from <code>mid</code>) and is  entropy or standard deviation for SYMs and NUMs, respectively.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">rnd</span><span class="p">(</span><span class="n">ent</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">counts</span><span class="p">)</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">this</span> <span class="ow">is</span> <span class="n">SYM</span> <span class="k">else</span> <span class="n">stdev</span><span class="p">(</span><span class="n">ok</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">_kept</span><span class="p">),</span><span class="n">decimals</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p><code>stats</code> returns an <code>obj</code> with <code>mid</code> or <code>div</code> on many columns. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">mid</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">obj</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span><span class="o">**</span><span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">txt</span><span class="p">:</span><span class="n">fun</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">decimals</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cols</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="p">)})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <h2>COLS (makes many columns)</h2>
<p>Convert a list of strings to NUMs or SYMs. Anything ending with &ldquo;X&rdquo; is ignore.
Upper case names become NUMs (and everything else is a SYM). For convenience, list
all the independent/dependent variables together in <code>x.y</code> respectively.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">COLS</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
  <span class="n">cols</span> <span class="o">=</span> <span class="n">obj</span><span class="p">(</span><span class="n">this</span><span class="o">=</span><span class="n">COLS</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">[],</span> <span class="n">y</span><span class="o">=</span><span class="p">[],</span> <span class="nb">all</span><span class="o">=</span><span class="p">[])</span>
  <span class="n">cols</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span>
  <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
    <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">NUM</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">else</span> <span class="n">SYM</span><span class="p">)(</span><span class="n">at</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="n">cols</span><span class="o">.</span><span class="n">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">col</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
      <span class="p">(</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;-+!&quot;</span> <span class="k">else</span> <span class="n">cols</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">cols</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <h2>DATA</h2>
<p><code>DATA</code> instances store ROWs, and summarized those into columns.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">DATA</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="p">[]):</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="ow">or</span> <span class="n">obj</span><span class="p">(</span><span class="n">this</span><span class="o">=</span><span class="n">DATA</span><span class="p">,</span><span class="n">rows</span><span class="o">=</span><span class="p">[],</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span> <span class="c1"># reading row1 (list of column names)</span>
      <span class="n">data</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">COLS</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">row</span> <span class="o">=</span> <span class="n">ROW</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">row</span> <span class="c1"># ensure we are reading ROWs</span>
      <span class="n">data</span><span class="o">.</span><span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span><span class="n">row</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
          <span class="n">add</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">data</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p><strong>DATA functions:</strong> <br />
 Copy the structure of a <code>data</code> table; </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">[]):</span> <span class="k">return</span> <span class="n">DATA</span><span class="p">(</span><span class="n">DATA</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">names</span><span class="p">]),</span> <span class="n">rows</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Sort <code>rows</code> worst to best.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">betters</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="o">=</span><span class="p">[]):</span>
  <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rows</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
                <span class="n">key</span><span class="o">=</span><span class="n">cmp2key</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">:</span> <span class="n">better</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">)))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p><code>Row1</code> is better than <code>row2</code> if moving to it losses less than otherwise.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">better</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">):</span>
  <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row1</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">]),</span> <span class="n">norm</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row2</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">])</span>
    <span class="n">s1</span>  <span class="o">-=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">s2</span>  <span class="o">-=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">s1</span> <span class="o">/</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">s2</span> <span class="o">/</span> <span class="n">n</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Sort <code>rows</code> via <code>better</code>. If no <code>rows</code>, then use <code>data.row</code>. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">betters</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="o">=</span><span class="p">[]):</span>
  <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rows</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
                <span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">:</span> <span class="n">better</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">)))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <hr />
<p>Map <code>x</code> to a small number of values.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">discretize</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span> <span class="k">return</span>
  <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">this</span> <span class="ow">is</span> <span class="n">NUM</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">bins</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">col</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">col</span><span class="o">.</span><span class="n">lo</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">inf</span><span class="p">))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">x</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Track what <code>x</code> value ranges hold what <code>rows</code> (and those <code>rows</code>
are divided inside <code>ys</code> according to their class.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">BIN</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">lo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">hi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">B</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="o">=</span><span class="n">lo</span> <span class="ow">or</span> <span class="n">inf</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="o">=</span><span class="n">hi</span> <span class="ow">or</span> <span class="n">lo</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="o">=</span><span class="p">{};</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">=</span><span class="n">R</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">txt</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span> <span class="n">inf</span><span class="p">:</span>     <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">txt</span><span class="si">}</span><span class="s2">&gt;=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">inf</span><span class="p">:</span>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">txt</span><span class="si">}</span><span class="s2">&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Update the <code>x</code> ranges and the set of <code>rows</code> help in that <code>x</code> range.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">binAdd</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
  <span class="nb">bin</span><span class="o">.</span><span class="n">n</span>     <span class="o">+=</span> <span class="mi">1</span>
  <span class="nb">bin</span><span class="o">.</span><span class="n">lo</span>     <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">bin</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="nb">bin</span><span class="o">.</span><span class="n">hi</span>     <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">bin</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="nb">bin</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>  <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="nb">set</span><span class="p">())</span>
  <span class="nb">bin</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">bin</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Combine two <code>bins</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">bin1</span><span class="p">,</span> <span class="n">bin2</span><span class="p">):</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">BIN</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">bin1</span><span class="o">.</span><span class="n">at</span><span class="p">,</span> <span class="n">txt</span><span class="o">=</span><span class="n">bin1</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span>
            <span class="n">lo</span><span class="o">=</span><span class="n">bin1</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="n">bin2</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span>
            <span class="n">B</span><span class="o">=</span><span class="n">bin1</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">bin2</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
  <span class="n">out</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">bin1</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">bin2</span><span class="o">.</span><span class="n">n</span>
  <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bin1</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="n">bin2</span><span class="o">.</span><span class="n">ys</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
      <span class="n">old</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span>  <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="nb">set</span><span class="p">())</span>
      <span class="n">out</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span>  <span class="o">=</span> <span class="n">old</span> <span class="o">|</span> <span class="n">d</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">out</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>Return the merge of two bins, but only if that merge is useful.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">merged</span><span class="p">(</span><span class="n">bin1</span><span class="p">,</span><span class="n">bin2</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">best</span><span class="p">):</span>
  <span class="n">out</span>   <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">bin1</span><span class="p">,</span><span class="n">bin2</span><span class="p">)</span>
  <span class="n">eps</span>   <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">*</span><span class="n">the</span><span class="o">.</span><span class="n">cohen</span>
  <span class="n">small</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">n</span> <span class="o">/</span> <span class="n">the</span><span class="o">.</span><span class="n">bins</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">best</span><span class="p">,[]))</span><span class="o">/</span><span class="n">out</span><span class="o">.</span><span class="n">B</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span> <span class="k">return</span> <span class="n">out</span>
  <span class="k">if</span> <span class="n">bin1</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">small</span> <span class="ow">or</span> <span class="n">bin1</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">bin1</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="n">eps</span> <span class="p">:</span> <span class="k">return</span> <span class="n">out</span>
  <span class="k">if</span> <span class="n">bin2</span><span class="o">.</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">small</span> <span class="ow">or</span> <span class="n">bin2</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">bin2</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="n">eps</span> <span class="p">:</span> <span class="k">return</span> <span class="n">out</span>
  <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span> <span class="o">=</span> <span class="n">binEnt</span><span class="p">(</span><span class="n">bin1</span><span class="p">),</span> <span class="n">binEnt</span><span class="p">(</span><span class="n">bin2</span><span class="p">),</span> <span class="n">binEnt</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">e3</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">bin1</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">e1</span> <span class="o">+</span> <span class="n">bin2</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">e2</span><span class="p">)</span><span class="o">/</span><span class="n">out</span><span class="o">.</span><span class="n">n</span> <span class="p">:</span> <span class="k">return</span> <span class="n">out</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Returns the entropy of the row distributions in a <code>bin</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">binEnt</span><span class="p">(</span><span class="nb">bin</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">ent</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">set1</span> <span class="ow">in</span> <span class="nb">bin</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Find attribute ranges that distinguish between the rows in
<code>data1</code> and <code>data2</code>. If <code>elite</code> then sort the ranges by their
<code>score</code>, then return the first <code>the.Beam</code> items.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">contrasts</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">,</span> <span class="n">elite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
  <span class="n">top</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_contrasts</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">)</span>
  <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
  <span class="k">if</span> <span class="n">elite</span><span class="p">:</span>
    <span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="nb">bin</span><span class="p">:</span> <span class="nb">bin</span><span class="o">.</span><span class="n">score</span><span class="p">):</span>
      <span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="nb">bin</span>
      <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">bin</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">inf</span> <span class="ow">and</span> <span class="nb">bin</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span> <span class="n">inf</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">bin</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="n">top</span><span class="o">.</span><span class="n">score</span><span class="o">*</span><span class="mf">.1</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">the</span><span class="o">.</span><span class="n">Beam</span><span class="p">:</span> <span class="k">yield</span> <span class="nb">bin</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span> <span class="k">yield</span> <span class="nb">bin</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>Divide values from each <code>data</code> into a few values, then
merge uninformative divisions).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_contrasts</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">):</span>
  <span class="n">data12</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data1</span><span class="o">.</span><span class="n">rows</span> <span class="o">+</span> <span class="n">data2</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data12</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">klass</span><span class="p">,</span><span class="n">rows</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">best</span><span class="o">=</span><span class="n">data1</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">rest</span><span class="o">=</span><span class="n">data2</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">:=</span> <span class="n">discretize</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">z</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span> <span class="n">bins</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">BIN</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">col</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span><span class="n">lo</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                          <span class="n">B</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span> <span class="n">R</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data2</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
          <span class="n">binAdd</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">z</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="n">merges</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">z</span><span class="p">:</span><span class="n">z</span><span class="o">.</span><span class="n">lo</span><span class="p">),</span><span class="s2">&quot;best&quot;</span><span class="p">):</span>
      <span class="k">yield</span> <span class="n">value</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Find ranges, expand the ranges to cover gaps in the data.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">merges</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">best</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">this</span> <span class="ow">is</span> <span class="n">SYM</span><span class="p">:</span> <span class="k">return</span> <span class="n">bins</span>
  <span class="n">bins</span> <span class="o">=</span> <span class="n">mergeds</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">best</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">bins</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lo</span>
  <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="n">inf</span>
  <span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span>  <span class="n">inf</span>
  <span class="k">return</span> <span class="n">bins</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>While there exists adjacent ranges that can be merged, merge them
then look for other possible merges.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">mergeds</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span><span class="n">best</span><span class="p">):</span>
  <span class="n">b</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="p">[],</span><span class="mi">0</span>
  <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">new</span> <span class="o">:=</span> <span class="n">merged</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">,</span><span class="n">best</span><span class="p">):</span> <span class="n">now</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">new</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">b</span> <span class="o">+=</span> <span class="p">[</span><span class="n">now</span><span class="p">]</span>
    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">a</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">else</span> <span class="n">mergeds</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span><span class="n">best</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>Score a bin, on a range of possible criteria. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
  <span class="n">b</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;best&quot;</span><span class="p">,</span><span class="nb">set</span><span class="p">()),</span> <span class="nb">bin</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rest&quot;</span><span class="p">,</span><span class="nb">set</span><span class="p">())</span>
  <span class="nb">bin</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">_value</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">bin</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="nb">bin</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">bin</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Helper function for <code>value</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_value</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">R</span><span class="p">):</span>
  <span class="n">b</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">inf</span><span class="p">),</span> <span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="n">R</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">inf</span><span class="p">)</span>
  <span class="k">match</span> <span class="n">the</span><span class="o">.</span><span class="n">want</span><span class="p">:</span>
    <span class="k">case</span> <span class="s2">&quot;operate&quot;</span>  <span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">r</span><span class="p">)</span>
    <span class="k">case</span> <span class="s2">&quot;mitigate&quot;</span> <span class="p">:</span> <span class="k">return</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
    <span class="k">case</span> <span class="s2">&quot;monitor&quot;</span>  <span class="p">:</span> <span class="k">return</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
    <span class="k">case</span> <span class="s2">&quot;xtend&quot;</span>    <span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
    <span class="k">case</span> <span class="s2">&quot;xplore&quot;</span>   <span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>Return  a row if its selected by a <code>bin</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span><span class="n">row</span><span class="p">):</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="nb">bin</span><span class="o">.</span><span class="n">at</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span>                         <span class="p">:</span> <span class="k">return</span> <span class="n">row</span>
  <span class="k">if</span> <span class="nb">bin</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="nb">bin</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span> <span class="n">x</span>          <span class="p">:</span> <span class="k">return</span> <span class="n">row</span>
  <span class="k">if</span> <span class="nb">bin</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">inf</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span>  <span class="nb">bin</span><span class="o">.</span><span class="n">hi</span> <span class="p">:</span> <span class="k">return</span> <span class="n">row</span>
  <span class="k">if</span> <span class="nb">bin</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span>  <span class="n">inf</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">lo</span> <span class="p">:</span> <span class="k">return</span> <span class="n">row</span>
  <span class="k">if</span> <span class="nb">bin</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">bin</span><span class="o">.</span><span class="n">hi</span>     <span class="p">:</span> <span class="k">return</span> <span class="n">row</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>Return  the rows selected by a set of bins.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">selects</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">rows</span><span class="p">):</span>
  <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
  <span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="nb">bin</span><span class="o">.</span><span class="n">at</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">bin</span><span class="o">.</span><span class="n">at</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
    <span class="n">d</span><span class="p">[</span><span class="nb">bin</span><span class="o">.</span><span class="n">at</span><span class="p">]</span> <span class="o">=</span> <span class="n">here</span> <span class="o">|</span> <span class="nb">set</span><span class="p">([</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span> <span class="k">if</span> <span class="n">select</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span><span class="n">row</span><span class="p">)])</span>
  <span class="n">out</span><span class="o">=</span> <span class="kc">None</span>
  <span class="k">for</span> <span class="n">set1</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">&amp;</span> <span class="n">set1</span>
    <span class="k">else</span>  <span class="p">:</span> <span class="n">out</span> <span class="o">=</span> <span class="n">set1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">return</span> 
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span> <span class="k">return</span>
  <span class="k">return</span> <span class="n">out</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <hr />
<p>Short cuts</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">r</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">random</span>
<span class="n">inf</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>Print colors.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">red</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">colored</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">green</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">colored</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">yellow</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">colored</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">bold</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="n">colored</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&quot;white&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>Round numbers, if <code>decimals</code> is set.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">rnd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">decimals</span><span class="p">)</span> <span class="k">if</span> <span class="n">decimals</span> <span class="k">else</span>  <span class="n">x</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>Return an item at some step along its length.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">per</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mf">.5</span><span class="p">):</span>
  <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))))</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>Return middle point of a list</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="k">return</span> <span class="n">per</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mf">.5</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>Plus or minus 1.28 standard deviations covers 90% of the data.
Therefore, sd = (.9sd - .1sd)/2.56</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">stdev</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="n">per</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mf">.9</span><span class="p">)</span> <span class="o">-</span> <span class="n">per</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mf">.1</span><span class="p">))</span><span class="o">/</span><span class="mf">2.56</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>Returns the diversity of a set of symbols.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">ent</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
  <span class="n">N</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="p">))</span>
  <span class="k">return</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">N</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>Returns all subsets.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">powerset</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="n">r</span> <span class="o">=</span> <span class="p">[[]]</span>
  <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span> <span class="n">r</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>Converts strings to things.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">coerce</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="n">x</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>Pretty-print of a dictionary.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">printd</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
  <span class="n">p</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;()&#39;</span> <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
  <span class="k">return</span> <span class="s2">&quot;{&quot;</span><span class="o">+</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;_&quot;</span><span class="p">]))</span><span class="o">+</span><span class="s2">&quot;}&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>Read a csv file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">csv</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span>
      <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([\n\t\r&quot;</span><span class="se">\&#39;</span><span class="s1"> ]|#.*)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[</span><span class="n">coerce</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>Parse the doc string (at top of file) to extract the settings.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="n">setting</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\n\s*-\w+\s*--(\w+)[^=]*=\s*(\S+)&quot;</span>
  <span class="k">return</span> <span class="n">obj</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">coerce</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="n">s</span><span class="p">)})</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <hr />
<p>Top-level control. Prints help or the number of <code>egs</code> that return <code>False</code>.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">runs</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">the</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
    <span class="n">headings</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[#]+ [A-Z][A-Z]+:&quot;</span><span class="p">,</span><span class="s2">&quot; [-][-]?[\S]+&quot;</span>
    <span class="n">show</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">headings</span><span class="p">,</span> <span class="n">show</span><span class="p">(</span><span class="n">yellow</span><span class="p">),</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">show</span><span class="p">(</span><span class="n">bold</span><span class="p">),</span> <span class="vm">__doc__</span><span class="p">)))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">n</span><span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">run</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">fun</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">fun</span> <span class="ow">in</span> <span class="n">egs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                       <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;_&quot;</span> <span class="ow">and</span> <span class="n">the</span><span class="o">.</span><span class="n">go</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">]])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">red</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> FAILURE(S)&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">green</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> FAILURE(S)&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">n</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>Run one example, initialize the random seed before and all the
options afterwards</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">fun</span><span class="p">):</span>
  <span class="n">d</span> <span class="o">=</span> <span class="n">the</span><span class="o">.</span><span class="vm">__dict__</span>
  <span class="n">saved</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">}</span>
  <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">fun</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">saved</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">saved</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">red</span><span class="p">(</span><span class="s2">&quot;FAIL&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="kc">False</span> <span class="k">else</span> <span class="n">green</span><span class="p">(</span><span class="s2">&quot;PASS&quot;</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">out</span><span class="o">==</span><span class="kc">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>Update a dictionary from command-line flagss</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
  <span class="n">d1</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="vm">__dict__</span>
  <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
      <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">x</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="o">+</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">d1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span> <span class="n">coerce</span><span class="p">(</span><span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="n">v</span><span class="o">==</span><span class="s2">&quot;False&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;False&quot;</span> <span class="k">if</span> <span class="n">v</span><span class="o">==</span><span class="s2">&quot;True&quot;</span> <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
  <span class="k">return</span> <span class="n">d</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <hr />
<p>Define examples.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">egs</span><span class="o">=</span><span class="p">{}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-58'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-58'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">eg</span><span class="p">(</span><span class="n">f</span><span class="p">):</span> <span class="n">egs</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">=</span> <span class="n">f</span><span class="p">;</span> <span class="k">return</span> <span class="n">f</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-59'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-59'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">thed</span><span class="p">():</span> <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">the</span><span class="p">),</span><span class="s2">&quot;...&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">powered</span><span class="p">():</span> <span class="nb">print</span><span class="p">(</span><span class="n">powerset</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">),</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">colnum</span><span class="p">():</span>
  <span class="n">num</span> <span class="o">=</span> <span class="n">NUM</span><span class="p">()</span>
  <span class="p">[</span><span class="n">add</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">keep</span><span class="p">)]</span>
  <span class="k">return</span> <span class="mf">9.95</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">10.05</span> <span class="ow">and</span> <span class="mf">1.9</span> <span class="o">&lt;=</span> <span class="n">div</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">&lt;=</span><span class="mf">2.1</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">colnum2</span><span class="p">():</span>
  <span class="n">num</span> <span class="o">=</span> <span class="n">NUM</span><span class="p">()</span>
  <span class="n">the</span><span class="o">.</span><span class="n">keep</span><span class="o">=</span><span class="mi">20</span>
  <span class="p">[</span><span class="n">add</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">ok</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">.</span><span class="n">_kept</span><span class="p">)</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">colnum3</span><span class="p">():</span>
  <span class="k">return</span> <span class="n">the</span><span class="o">.</span><span class="n">keep</span> <span class="o">==</span> <span class="mi">512</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">colsym</span><span class="p">():</span>
  <span class="n">sym</span> <span class="o">=</span> <span class="n">SYM</span><span class="p">()</span>
  <span class="p">[</span><span class="n">add</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s2">&quot;aaaabbc&quot;</span><span class="p">]</span>
  <span class="k">return</span> <span class="mf">1.37</span> <span class="o">&lt;</span> <span class="n">div</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.38</span> <span class="ow">and</span> <span class="n">mid</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;a&#39;</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">csved</span><span class="p">():</span> <span class="k">return</span> <span class="mi">3192</span><span class="o">==</span><span class="nb">sum</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">csv</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">file</span><span class="p">)))</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">statd</span><span class="p">():</span>
  <span class="n">data</span><span class="o">=</span><span class="n">DATA</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;../data/auto93.csv&quot;</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">fun</span><span class="o">=</span><span class="n">div</span><span class="p">))</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">orderer</span><span class="p">():</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">csv</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">file</span><span class="p">))</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="n">betters</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;all &quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">(</span><span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">:])))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rest&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">(</span><span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="p">[:</span><span class="mi">30</span><span class="p">])))</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">contrasted</span><span class="p">():</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">csv</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">file</span><span class="p">))</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="n">betters</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">the</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
  <span class="n">best</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">:])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-60'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-60'>#</a>
      </div>
      <p>rest = clone(data,random.sample(rows[:-b],r))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">rest</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="p">[:</span><span class="n">b</span><span class="o">*</span><span class="n">the</span><span class="o">.</span><span class="n">rest</span><span class="p">])</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">all &quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">(</span><span class="n">best</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rest&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">(</span><span class="n">rest</span><span class="p">))</span>
  <span class="n">b4</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="n">contrasts</span><span class="p">(</span><span class="n">best</span><span class="p">,</span><span class="n">rest</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">bin</span><span class="o">.</span><span class="n">txt</span> <span class="o">!=</span> <span class="n">b4</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">bin</span><span class="o">.</span><span class="n">txt</span><span class="si">:</span><span class="s2">10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">bin</span><span class="o">.</span><span class="n">lo</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">bin</span><span class="o">.</span><span class="n">hi</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
          <span class="n">obj</span><span class="p">(</span><span class="n">best</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;best&quot;</span><span class="p">,</span><span class="nb">set</span><span class="p">())),</span>
              <span class="n">rest</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rest&quot;</span><span class="p">,</span><span class="nb">set</span><span class="p">())),</span>
              <span class="n">score</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">bin</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="n">b4</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">.</span><span class="n">txt</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-61'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-61'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">bested</span><span class="p">():</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">csv</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">file</span><span class="p">))</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="n">betters</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">the</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
  <span class="n">best</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">:])</span>
  <span class="n">rest</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="p">[:</span><span class="n">b</span><span class="o">*</span><span class="n">the</span><span class="o">.</span><span class="n">rest</span><span class="p">])</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="n">contrasts</span><span class="p">(</span><span class="n">best</span><span class="p">,</span><span class="n">rest</span><span class="p">,</span> <span class="n">elite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">bin</span><span class="p">,</span><span class="nb">bin</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>

<span class="nd">@eg</span>
<span class="k">def</span> <span class="nf">bested2</span><span class="p">():</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">csv</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">file</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ALL:&quot;</span><span class="p">,</span> <span class="n">stats</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="n">betters</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">the</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
  <span class="n">best</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="p">:])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-62'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-62'>#</a>
      </div>
      <p>rest = clone(data,rows[:b*the.rest])</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>  <span class="n">rest</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="n">b</span><span class="o">*</span><span class="n">the</span><span class="o">.</span><span class="n">rest</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">bins</span> <span class="ow">in</span> <span class="n">powerset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">contrasts</span><span class="p">(</span><span class="n">best</span><span class="p">,</span><span class="n">rest</span><span class="p">,</span> <span class="n">elite</span><span class="o">=</span><span class="kc">True</span><span class="p">))):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">stats</span><span class="p">(</span><span class="n">clone</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">selects</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">rows</span><span class="p">))),</span><span class="n">bins</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-63'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-63'>#</a>
      </div>
      <hr />
<p>Start-up</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">the</span> <span class="o">=</span> <span class="n">settings</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="n">the</span> <span class="o">=</span> <span class="n">cli</span><span class="p">(</span><span class="n">the</span><span class="p">)</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">runs</span><span class="p">())</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
